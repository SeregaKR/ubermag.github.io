
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tutorial: mag2exp &#8212; ubermag  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/colours.css?v=f1e252c1" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=fd10adb8"></script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'getting-started/notebooks/mag2exp';</script>
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logoL.png" class="logo__image only-light" alt="ubermag  documentation - Home"/>
    <script>document.write(`<img src="../../_static/logoL.png" class="logo__image only-dark" alt="ubermag  documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../demo.html">
                        Demo
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../installation.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../documentation.html">
                        Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../changelog.html">
                        Changelog
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../help.html">
                        Help
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../contributing.html">
                        Contributing
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../news.html">
                        News
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ubermag" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../demo.html">
                        Demo
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../installation.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../documentation.html">
                        Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../changelog.html">
                        Changelog
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../help.html">
                        Help
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../contributing.html">
                        Contributing
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../news.html">
                        News
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ubermag" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Tutorial: mag2exp</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="Tutorial:-mag2exp">
<h1>Tutorial: mag2exp<a class="headerlink" href="#Tutorial:-mag2exp" title="Link to this heading">#</a></h1>
<p>In the previous tutorials we have seen how to use Ubermag to create realistic magnetisation textures. However, when performing real world experiments it is often not possible to directly probe this magnetisation texture.</p>
<p>We have created the <code class="docutils literal notranslate"><span class="pre">mag2exp</span></code> package to enable virtual experiments, that mimic real world experiments to be carried out on a spatially resolved magnetisation texture. This tutorial is designed to introduce you to some of the features that are available. More in-depth tutorials of these and more techniques are given in the <code class="docutils literal notranslate"><span class="pre">mag2exp</span></code> package documentation and the api reference.</p>
<section id="Setting-up-a-system">
<h2>Setting up a system<a class="headerlink" href="#Setting-up-a-system" title="Link to this heading">#</a></h2>
<p>First we set up a system to create a realistic magnetisation texture which we can probe using a variety of techniques.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">discretisedfield</span> <span class="k">as</span> <span class="nn">df</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">micromagneticmodel</span> <span class="k">as</span> <span class="nn">mm</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Mesh</span><span class="p">(</span>
    <span class="n">p1</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">200e-9</span><span class="p">,</span> <span class="o">-</span><span class="mf">200e-9</span><span class="p">,</span> <span class="o">-</span><span class="mf">20e-9</span><span class="p">),</span>
    <span class="n">p2</span><span class="o">=</span><span class="p">(</span><span class="mf">200e-9</span><span class="p">,</span> <span class="mf">200e-9</span><span class="p">,</span> <span class="mf">20e-9</span><span class="p">),</span>
    <span class="n">cell</span><span class="o">=</span><span class="p">(</span><span class="mf">8e-9</span><span class="p">,</span> <span class="mf">8e-9</span><span class="p">,</span> <span class="mf">10e-9</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">system</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">System</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mag2exp_demo&#39;</span><span class="p">)</span>

<span class="c1"># Values for MnSi</span>
<span class="n">system</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">mm</span><span class="o">.</span><span class="n">Exchange</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="mf">15e-12</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">mm</span><span class="o">.</span><span class="n">DMI</span><span class="p">(</span><span class="n">D</span><span class="o">=</span><span class="mf">3e-3</span><span class="p">,</span> <span class="n">crystalclass</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">mm</span><span class="o">.</span><span class="n">UniaxialAnisotropy</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mf">0.2e6</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">mm</span><span class="o">.</span><span class="n">Zeeman</span><span class="p">(</span><span class="n">H</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">3.5e5</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">mm</span><span class="o">.</span><span class="n">Demag</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">Ms</span> <span class="o">=</span> <span class="mf">580e3</span>

<span class="k">def</span> <span class="nf">m_fun</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

<span class="c1"># create system with above geometry and initial magnetisation</span>
<span class="n">system</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">nvdim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">m_fun</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">Ms</span><span class="p">)</span>

<span class="n">system</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mpl</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/getting-started_notebooks_mag2exp_2_0.png" src="../../_images/getting-started_notebooks_mag2exp_2_0.png" />
</div>
</div>
<p>Relax the system</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">oommfc</span> <span class="k">as</span> <span class="nn">oc</span>

<span class="n">md</span> <span class="o">=</span> <span class="n">oc</span><span class="o">.</span><span class="n">MinDriver</span><span class="p">()</span>
<span class="n">md</span><span class="o">.</span><span class="n">drive</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>

<span class="n">system</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mpl</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Running OOMMF (ExeOOMMFRunner)[2023/10/23 15:52]... (4.2 s)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/getting-started_notebooks_mag2exp_4_1.png" src="../../_images/getting-started_notebooks_mag2exp_4_1.png" />
</div>
</div>
<p>This magnetisation texture shows a Bloch skyrmion lattice.</p>
</section>
<section id="Microscopy-techniques">
<h2>Microscopy techniques<a class="headerlink" href="#Microscopy-techniques" title="Link to this heading">#</a></h2>
<p>Microscopy techniques enable the imaging of magnetic structures on a nanometre length scale. This makes them powerful techniques to corroborate micromagnetic simulations due to the similarity of the length scales probed.</p>
<p>In this notebook we will look into two microscopy techniques that <code class="docutils literal notranslate"><span class="pre">mag2exp</span></code> can simulate: - Lorentz TEM - X-ray</p>
<p>Further details of more microscopy techniques are given in the <code class="docutils literal notranslate"><span class="pre">mag2exp</span></code> package documentation and the api reference.</p>
<section id="Lorentz-TEM">
<h3>Lorentz TEM<a class="headerlink" href="#Lorentz-TEM" title="Link to this heading">#</a></h3>
<p>Lorentz Transmission Electron Microscopy (Lorentz TEM) is a popular method for imaging magnetic structures in thin lamellae of magnetic materials.</p>
<p>Transmission electron microscopy involves electrons being accelerated through a voltage typically between 60–300~kV. This electron beam travels down the microscope column and passes through a thin sample called a lamella. The direction of the electron beam is defined to be in the negative <span class="math notranslate nohighlight">\(z\)</span> direction in the technique frame of <code class="docutils literal notranslate"><span class="pre">mag2exp</span></code>.</p>
<p>If the sample is magnetic, the electrons are deflected by the Lorentz force as they pass through. This means that electron microscopy is sensitive to the magnetic flux density <span class="math notranslate nohighlight">\(\textbf{B}\)</span> from the sample (rather than the magnetisation <span class="math notranslate nohighlight">\(\textbf{M}\)</span>) and that due to the nature of the cross-product, it is sensitive only to the component of <span class="math notranslate nohighlight">\(\textbf{B}\)</span> normal to the electron beam.</p>
<p>The effect of the beam deflection is that the electrons emerge from the sample having acquired a phase shift. This phase shift can be calculated using <code class="docutils literal notranslate"><span class="pre">mag2exp</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mag2exp</span>

<span class="n">phase</span><span class="p">,</span> <span class="n">ft_phase</span> <span class="o">=</span> <span class="n">mag2exp</span><span class="o">.</span><span class="n">ltem</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>

<span class="n">phase</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;spline16&quot;</span><span class="p">,</span> <span class="n">colorbar_label</span><span class="o">=</span><span class="s2">&quot;Phase (rad.)&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/getting-started_notebooks_mag2exp_8_0.png" src="../../_images/getting-started_notebooks_mag2exp_8_0.png" />
</div>
</div>
<p>The phase can be directly recovered by Lorentz TEM techniques such as electron holography.</p>
<p>Another common technique is Lorentz TEM defocus imaging. This is where the microscope is defocused so the images produced become sensitive to the magnetisation of the sample.</p>
<p>Once the phase is measured, the defocus images can be obtained using <code class="docutils literal notranslate"><span class="pre">mag2exp</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_image</span> <span class="o">=</span> <span class="n">mag2exp</span><span class="o">.</span><span class="n">ltem</span><span class="o">.</span><span class="n">defocus_image</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">voltage</span><span class="o">=</span><span class="mf">300e3</span><span class="p">,</span> <span class="n">df_length</span><span class="o">=-</span><span class="mf">0.2e-3</span><span class="p">)</span>

<span class="n">df_image</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
    <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;spline16&quot;</span><span class="p">,</span>
    <span class="n">colorbar_label</span><span class="o">=</span><span class="s2">&quot;Intensity (counts)&quot;</span>
<span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/getting-started_notebooks_mag2exp_10_0.png" src="../../_images/getting-started_notebooks_mag2exp_10_0.png" />
</div>
</div>
</section>
<section id="X-ray-Holography">
<h3>X-ray Holography<a class="headerlink" href="#X-ray-Holography" title="Link to this heading">#</a></h3>
<p>A technique which is complmentary to Lorentz TEM is X-ray holography. X-ray holography is a technique which uses circularly polarised light to take advantage of the magnetic circular dichroism effect. In x-ray holography, a coherent beam of circularly polarised x-rays is incident on the sample and a reference slit. The scattered x-rays interfere and form a hologram which is recorded by the detector. The measured hologram can subsequently be combined with a differential filter and Fourier
transformed to reconstruct the holographic image which contains information on the out-of-plane magnetisation of the sample.</p>
<p>For the x-ray holography technique in <code class="docutils literal notranslate"><span class="pre">mag2exp</span></code>, the technique reference frame is defined with the incident beam propagating along the negative <span class="math notranslate nohighlight">\(z\)</span> direction</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">holo</span> <span class="o">=</span> <span class="n">mag2exp</span><span class="o">.</span><span class="n">x_ray</span><span class="o">.</span><span class="n">holography</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>

<span class="n">holo</span><span class="o">.</span><span class="n">mpl</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/getting-started_notebooks_mag2exp_12_0.png" src="../../_images/getting-started_notebooks_mag2exp_12_0.png" />
</div>
</div>
<p>Now is good time to introduce some helper functionality known as <code class="docutils literal notranslate"><span class="pre">quick_plots</span></code>. The <code class="docutils literal notranslate"><span class="pre">quick_plots</span></code> submodule, contains functions to each create an image that shows the outcome of the respective experimental techniques with a single line of Python code – trading ease of use against a lack of flexibility.</p>
<p>An example of this for X-ray holography is shown below with built in functionality for convolutions with a Gaussian of a certain <code class="docutils literal notranslate"><span class="pre">fwhm</span></code> to create more experimentally realistic images.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mag2exp</span><span class="o">.</span><span class="n">quick_plots</span><span class="o">.</span><span class="n">x_ray_holography</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="p">(</span><span class="mf">30e-9</span><span class="p">,</span> <span class="mf">30e-9</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/getting-started_notebooks_mag2exp_14_0.png" src="../../_images/getting-started_notebooks_mag2exp_14_0.png" />
</div>
</div>
</section>
</section>
<section id="Reciprocal-space">
<h2>Reciprocal space<a class="headerlink" href="#Reciprocal-space" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">mag2exp</span></code> also has the functionality to look at reciprocal space techniques such as Small Angle Neutron Scattering and Small Angle X-ray Scattering. Reciprocal space techniques are powerful techniques to examine the periodicity of magnetic structures.</p>
<section id="Small-Angle-Neutron-Scattering">
<h3>Small Angle Neutron Scattering<a class="headerlink" href="#Small-Angle-Neutron-Scattering" title="Link to this heading">#</a></h3>
<p>In small-angle neutron scattering (SANS) a beam of neutrons is incident on a sample in a transmission geometry and the neutrons scatter as they travel through the sample due to both nuclear and magnetic forces. In <code class="docutils literal notranslate"><span class="pre">mag2exp</span></code> only scattering due to the magnetisation of the sample is considered. The scattering pattern indicates the periodicity of the magnetic structure. The polarisation of the neutrons before and after scattering can be controlled to yield more information about the magnetisation
structure from spin-flip cross sections. For the SANS technique in <code class="docutils literal notranslate"><span class="pre">mag2exp</span></code>, the technique reference frame is defined to be the same as the sample reference frame.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cs</span> <span class="o">=</span> <span class="n">mag2exp</span><span class="o">.</span><span class="n">sans</span><span class="o">.</span><span class="n">cross_section</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;unpol&quot;</span><span class="p">,</span> <span class="n">polarisation</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">cs</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">k_z</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/getting-started_notebooks_mag2exp_17_0.png" src="../../_images/getting-started_notebooks_mag2exp_17_0.png" />
</div>
</div>
</section>
</section>
<section id="Magnetometry">
<h2>Magnetometry<a class="headerlink" href="#Magnetometry" title="Link to this heading">#</a></h2>
<p>Magnetometry techniques are a widely used and important tool for characterising many materials. These techniques are usually bulk sensitive and used to examine properties of magnetisation. In <code class="docutils literal notranslate"><span class="pre">mag2exp</span></code> we can look at quantities such as the magnetisation, the spatially averaged magnetisation direction and magnetic torque.</p>
<section id="Torque-magnetometry">
<h3>Torque magnetometry<a class="headerlink" href="#Torque-magnetometry" title="Link to this heading">#</a></h3>
<p>Torque magnetometry is a technique where a sample is placed in an external magnetic field and the torque on the sample due to the externally applied field is measured. This technique is commonly used to measure the anisotropy of materials by applying a large enough magnetic field to saturate the sample and then rotating the sample relative to the field to obtain the easy and hard axes. However, it can be difficult to interpret the experimental results of torque magnetometry techniques due to
effects such as demagnetisation. It is also hard to predict the torque magnetometry results for magnetic states that are not in the saturated state. <code class="docutils literal notranslate"><span class="pre">mag2exp</span></code> opens another avenue for interpretation of results by computationally simulating the torque of a magnetic state.</p>
<p>In this simultion we apply a 3 T field along the <span class="math notranslate nohighlight">\(z\)</span> direction and rotate it the th <span class="math notranslate nohighlight">\(yz\)</span> plane in 51 steps. The torque at each of these steps is measured and then plotted.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>

<span class="n">H_mag</span> <span class="o">=</span> <span class="mf">2.38e6</span>

<span class="n">torque_val_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">angle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">angles</span><span class="p">):</span>
    <span class="n">system</span><span class="o">.</span><span class="n">energy</span><span class="o">.</span><span class="n">zeeman</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">H_mag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">H_mag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
    <span class="n">md</span><span class="o">.</span><span class="n">drive</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">torque_val_x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mag2exp</span><span class="o">.</span><span class="n">magnetometry</span><span class="o">.</span><span class="n">torque</span><span class="p">(</span>
        <span class="n">system</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">energy</span><span class="o">.</span><span class="n">zeeman</span><span class="o">.</span><span class="n">H</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">torque_val_x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Angle (rad.)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Torque (Nm$^{-2}$)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/getting-started_notebooks_mag2exp_21_0.png" src="../../_images/getting-started_notebooks_mag2exp_21_0.png" />
</div>
</div>
<p>More in-depth tutorials of these and more techniques are given in the <code class="docutils literal notranslate"><span class="pre">mag2exp</span></code> package documentation and the API reference.</p>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Setting-up-a-system">Setting up a system</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Microscopy-techniques">Microscopy techniques</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Lorentz-TEM">Lorentz TEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#X-ray-Holography">X-ray Holography</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Reciprocal-space">Reciprocal space</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Small-Angle-Neutron-Scattering">Small Angle Neutron Scattering</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Magnetometry">Magnetometry</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Torque-magnetometry">Torque magnetometry</a></li>
</ul>
</li>
</ul>
</nav>


<div class="tocsection onthispace pt-5 bp-3">
    <h5>Try online:</h5>
    
    <a href="https://mybinder.org/v2/gh/ubermag/tutorials/latest?urlpath=lab/tree/getting-started/mag2exp.ipynb"  target="_blank" rel="noopener noreferrer">
    
        <img src="https://img.shields.io/badge/launch-binder-579aca.svg?logo=data:image/png;base64,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">
    </a>
    <h5>Try locally:</h5>
    <a href="https://ubermag.github.io/_sources/getting-started/notebooks/mag2exp.ipynb.txt" download="mag2exp.ipynb">
        <img src="https://img.shields.io/badge/download-notebook-blue">
    </a>
</div>
</div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../../_sources/getting-started/notebooks/mag2exp.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2022, Marijan Beg and Hans Fangohr.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>